<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Typing | BrightEducationSteno</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="assets/img/BrightEducationSteno.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet" />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <!--  Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <link href="assets/css/slider.css" rel="stylesheet" />
    <style>
        @font-face {
            font-family: Hindi;
            src: url(font/Hindi.ttf);
        }

        @font-face {
            font-family: 'Hindi';
            src: url('font/Hindi.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        .hindiFont {
            font-family: 'Hindi';
        }
    </style>

</head>

<body>
    <!-- Designed and Developed by Sunil Barara -->
    <!--Mobile Number: 7878438668 -->
    <app-contactcareernavbar></app-contactcareernavbar>

    <div class="section-title" style="padding-left: 4rem; padding-top: 10rem">
        <h2>Typing Test</h2>
        <p>Show your Steno skill</p>
    </div>
    <div class="body-container">
        <div class="main-container bgc-white">
            <div role="main" class="main-content">
                <div class="page-content">
                    <style>
                        .success {
                            color: #44b267;
                        }

                        .fail {
                            color: #e81c4e;
                        }


                        /*-- special --*/
                        .special,
                        #news,
                        .w3_content_agilleinfo_inner,
                        .team-section,
                        .plans-section {
                            padding: 25px 0;
                        }

                        h3.tittle,
                        h2.ptbl-inner-h-title,
                        h3.ptbl-inner-h-title {
                            color: #e83f3f;
                            font-size: 2.5em;
                            margin: 0;
                            text-align: center;
                            font-weight: 600;
                            letter-spacing: 3px;
                        }

                        h2.ptbl-inner-h-title,
                        h3.ptbl-inner-h-title {
                            margin-bottom: 1em;
                            text-transform: uppercase;
                        }

                        h3.tittle.two {
                            color: #fff;
                        }


                        .switch {
                            position: relative;
                            display: inline-block;
                            width: 60px;
                            height: 34px;
                        }

                        .switch input {
                            opacity: 0;
                            width: 0;
                            height: 0;
                        }

                        .slider {
                            position: absolute;
                            cursor: pointer;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background-color: #ccc;
                            -webkit-transition: .4s;
                            transition: .4s;
                        }

                        .slider:before {
                            position: absolute;
                            content: "";
                            height: 26px;
                            width: 26px;
                            left: 4px;
                            bottom: 4px;
                            background-color: white;
                            -webkit-transition: .4s;
                            transition: .4s;
                        }

                        input:checked+.slider {
                            background-color: #2196F3;
                        }

                        input:focus+.slider {
                            box-shadow: 0 0 1px #2196F3;
                        }

                        input:checked+.slider:before {
                            -webkit-transform: translateX(26px);
                            -ms-transform: translateX(26px);
                            transform: translateX(26px);
                        }

                        /* Rounded sliders */
                        .slider.round {
                            border-radius: 34px;
                        }

                        .slider.round:before {
                            border-radius: 50%;
                        }
                    </style>
                    <!-- Our price plan section -->
                    <div class="plans-section" style="padding:21px;overflow-x: scroll!important;">

                        <!-- -------------------------- TYping Modal Code is Here   -------------------- -->
                        <!-- Main Body Starts -->
                        <div id="" class="container" style="
    padding: 1px 30px;
   
   
    max-width: 100rem;">
                            <div class="stats" style="    text-align: right;
font-size: 18px;
margin-bottom: 30px;
display: flex;
justify-content: space-between;">
                                <div style="display:flex; justify-content: center; align-items:center;"> <button
                                        width="2px" style=" 
                background-color: #ff4a17;
                color: white;
                border-width: 0px;
                height: 31px;
                border-radius: 5px;" onclick="handleGoBack()">Go Back</button>
                                </div>
                                <!-- <div style="display:flex; justify-content:center;">
                                    <p style="padding: 4px;
border-radius: 6px;   
    
    font-size: 36px;
    font-weight: 700;
    text-transform: uppercase;
    font-family: " Poppins", sans-serif; color: #263d4d; }">Time: <span id="timer">00:00</span></p>
                                   
                                </div> -->
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    Backspace: <label class="switch">
                                        <input type="checkbox" onchange="handleBackspaceToggle(this)">
                                        <span class="slider round"></span>
                                    </label>
                                    Navigation: <label class="switch">
                                        <input type="checkbox" onchange="handleNavigationToggle(this)">
                                        <span class="slider round"></span>
                                    </label>
                                    <span style="
                                    font-size: 24px;
                                    font-weight: 500;
                                    font-family: Poppins, sans-serif;
                                    color: #263d4d;
                                ">
                                        Time: <span id="timer">1:00</span>
                                    </span>
                                </div>

                            </div>

                            <textarea style="width: 100%;
border-radius: 5px;
padding: 10px 5px;
font-size: 16px;

    font-weight: 700;
    font-size: 23px;" rows="6" spellcheck="false" id="quote-input" placeholder="Type here when the test starts.."
                                class="hindiFont" onpaste="return false;" ondrop="return false;"
                                autocomplete="off"></textarea>
                            <button class="button" style="float: right;
  margin-top: 20px;
  background-color: rgb(25 45 102);
  color: #ffffff;
  border: none;
  padding: 10px 30px;
  border-radius: 5px;
  font-size: 18px;" id="start-test" onclick="startTest()">Start Test</button>
                            <button class="button" style="float: right;
  margin-top: 20px;
 background-color: rgb(25 45 102);
  color: #ffffff;
  border: none;
  padding: 10px 30px;
  border-radius: 5px;
  font-size: 18px;" id="stop-test" onclick="displayResult()">Submit</button>
                            <div class="result" style="margin-top: 40px; border: 3px solid black;
  display: none;">
                                <h3 style="padding: 13px 0 0 23px;">Result</h3>
                                <div class="wrapper" style="font-size: 21px;  display: flex;
  justify-content: space-around;">
                                    <p>Accuracy: <span id="accuracy"></span></p>
                                    <p>Speed: <span id="wpm"></span></p>
                                    <p>Total Type: <span id="TotalTyped"></span></p>
                                    <p>Mistakes: <span id="mistakes"></span></p>
                                </div>



                                <div class="result" id="resultMainDiv" style="  display:none;  
                              justify-content: space-around;
                              min-height: 26rem;
                              margin-top: 3rem;padding:1 rem;
                              background-color: white;padding: 17px;border-top: 3px solid;
                              ">
                                    <div class="" id="wrapperResultId" style="   justify-content: space-around;font-weight: 700;
                                                              font-size: 23px;
                                                              font-family: monospace;">

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="quote" style="display:none;">

                        </div>

                        <!-- ----------------------- Table code is here ------------------- -->




                    </div>
                </div>
            </div>
        </div><!-- .modal-aside -->
    </div>
    </div>
    <app-whatsapp></app-whatsapp>
    <app-footer></app-footer>
    <div id="preloader"></div>
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>


    <!-- Vendor JS Files -->
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <script src="https://code.jquery.com/jquery-2.2.0.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.js"></script>

    <!--   Main JS File -->
    <script defer src="assets/js/main.js"></script>
    <script src="assets/js/MyComponents.js"></script>
    <script>
        $(document).ready(function () {
            checkIsSprStudent();
            document.getElementById('header').style.backgroundColor = '#38434b'
        })

    </script>
    <Script>
        const textarea = document.getElementById("quote-input");

        // Always keep cursor at end
        function moveCursorToEnd() {
            if (allowNavigation) {
                const len = textarea.value.length;
                textarea.setSelectionRange(len, len);
            }
        }

        // On focus, set cursor at end
        textarea.addEventListener("focus", moveCursorToEnd);

        // On click, reset cursor at end
        textarea.addEventListener("mouseup", (e) => {
            if (allowNavigation) {
                e.preventDefault();   // stop manual placing
                moveCursorToEnd();
            }

        });



        let allowBackspace = false;
        let allowNavigation = false;
        handleBackspaceToggle = (checkbox) => {
            allowBackspace = checkbox.checked;
        }
        handleNavigationToggle = (checkbox) => {
            allowNavigation = checkbox.checked;
        }
        textarea.addEventListener("keydown", (e) => {
            if (allowNavigation && ["ArrowLeft", "ArrowUp", "Home", "PageUp"].includes(e.key)) {
                e.preventDefault();
            }
            if (allowBackspace && e.key === "Backspace") {
                e.preventDefault();
                return;
            }
        });
        let time = 60;
        let totalTimeInSecond;
        let correctWords = 0;
        let incorrectWords = 0;
        $(document).ready(function () {
            const TableData = document.getElementById('TableData');
            let SPR_StudentPhone = localStorage.getItem("SPR_StudentPhone");
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            let id = urlParams.get('Id')
            if (id == null) {
                id = queryString.substring(queryString.indexOf('D=') + 2, queryString.length)
            }
            renderNewQuote(id)

        })
        //Random Quotes Api URL
        const quoteApiUrl = "https://api.quotable.io/random?minLength=80&maxLength=100";
        let quoteSection = '';
        const userInput = document.getElementById("quote-input");
        let quote = "";
        let courseDataId = ''
        let timer = "";
        let mistakes = 0;
        let totaltypewords = 0;


        userInput.addEventListener("input", () => {
            calculateTypingAccuracy()
        })
        function calculateTypingAccuracy() {
            // console.log('referenceText=', document.getElementById('quote-input').value.length)
            correctWords = 0;
            incorrectWords = 0;
            let referenceText = quoteSection;
            let userInput = document.getElementById('quote-input').value;
            if (userInput.length > 0) {
                document.getElementById("stop-test").disabled = false;
                document.getElementById("stop-test").style.cursor = "pointer";
            } else {
                document.getElementById("stop-test").style.cursor = "not-allowed";
                document.getElementById("stop-test").disabled = true;
            }
            //   referenceText = referenceText.split(' ');
            if (userInput.length > 0) {
                userInput = userInput.trim();
                userInput = userInput.split(' ');
            }


            totaltypewords = userInput.length;
            document.getElementById("TotalTyped").innerText = userInput.length;
            for (let i = 0; i < userInput.length; i++) {
                if (referenceText[i] === userInput[i]) {
                    correctWords++;
                } else {
                    incorrectWords++;
                }
            }
            if (incorrectWords == 'Infinity' || incorrectWords == 'NaN')
                incorrectWords = 0;
            if (incorrectWords > 1) {
                incorrectWords += ' Words'
            } else {
                incorrectWords += ' Word'
            }
            console.log('correctWords=', correctWords)
            console.log(' userInput.length=', userInput.length)
            document.getElementById("mistakes").innerText = incorrectWords;
            const accuracy = (correctWords / userInput.length) * 100;
            return accuracy + '@' + incorrectWords;
        }
        function handleStartTest(id) {
            renderNewQuote(id);
            var part1 = document.getElementById('datatable');
            var part2 = document.getElementById('typingModalId');
            part1.style.display = 'none';
            part2.style.display = 'inline-block';

        }
        function handleGoBack() {
            history.back();
            var part1 = document.getElementById('datatable');
            var part2 = document.getElementById('typingModalId');
            part1.style.display = 'table';
            part2.style.display = 'none';
            quote = '';
        }
        //Display random quotes
        const renderNewQuote = async (id) => {
            courseDataId = id;
            let SPR_StudentPhone = localStorage.getItem("SPR_StudentPhone");
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Cookie", "BrowserId=g1Zrr_uOEe2gTR9C7VyOiA; CookieConsentPolicy=0:1; LSKey-c$CookieConsentPolicy=0:1");

            var raw = JSON.stringify({
                "Phone": SPR_StudentPhone,
                "courseContentId": id,
                "getTypingTestContent": 'getTypingTestContent'
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            fetch("https://cloudcertitude15-dev-ed.develop.my.salesforce-sites.com/services/apexrest/BrightEducationSteno", requestOptions)
                .then(response => response.json())
                .then(result => {

                    result = JSON.parse(result);
                    console.log('typing result=>', result)
                    if (result[0].Test_Language__c == 'Hindi') {
                        document.getElementById("wrapperResultId").style.fontFamily = 'Hindi';
                        document.getElementById("quote-input").style.fontFamily = 'Hindi';
                        document.getElementById("quote-input").setAttribute("placeholder", " टेस्ट शुरू होने पर यहां टाइप करें...");
                    } else {
                        document.getElementById("wrapperResultId").style.fontFamily = 'monospace';
                        document.getElementById("quote-input").style.fontFamily = 'monospace';
                    }

                    time = parseInt(result[0].Duration__c) * 60;
                    totalTimeInSecond = parseInt(result[0].Duration__c) * 60;
                    document.getElementById("timer").innerText = convertSecondsToTime(time);
                    //    document.getElementById("timer").innerText = time + "s";
                    let content = result[0].Audio_Text__c.split(" ");
                    //console.log('10092->', content); 
                    quote = content;

                    quoteSection = quote;
                })
                .catch(error => console.log('error=', error));


        };

        function convertSecondsToTime(seconds) {
            var minutes = Math.floor(seconds / 60);
            var remainingSeconds = seconds % 60;

            // Add leading zero if necessary
            var minutesStr = minutes < 10 ? "0" + minutes : minutes.toString();
            var secondsStr = remainingSeconds < 10 ? "0" + remainingSeconds : remainingSeconds.toString();

            return minutesStr + ":" + secondsStr;
        }
        function updateTimer() {
            var timerElement = document.getElementById("timer");
            var currentTime = timerElement.innerText;
            var timeParts = currentTime.split(":");
            var minutes = parseInt(timeParts[0]);
            var seconds = parseInt(timeParts[1]);
            if (minutes == 0 && seconds == 0) {
                displayResult();
            } else {
                var totalSeconds = minutes * 60 + seconds;
                if (totalSeconds > 0) {
                    totalSeconds--;
                    time--;
                    timerElement.innerText = convertSecondsToTime(totalSeconds);
                }
            }
        }


        //Sets timer
        const timeReduce = () => {
            //time = 60;
            timer = setInterval(updateTimer, 1000);
        };
        let backspaceCount = 0;
        userInput.addEventListener("input", (e) => {
            console.log('input event triggered', e.target.value);
            calculateTypingAccuracy();

            // Track backspaces
            if (e.inputType === "deleteContentBackward") {
                backspaceCount++;
            }


        });
        const displayResult = () => {

            document.getElementById("resultMainDiv").style.display = 'block';
            document.getElementById("quote-input").style.display = 'none';
            var resultSection = document.getElementById("wrapperResultId")
            // Words in above box
            var quotee = quoteSection;
            const words = quotee;
            // ended

            // words in below box

            let typedwords = document.getElementById("quote-input").value.replace(/\s+/g, ' ').trim().split(' ');

            let totalTypedString = typedwords.join(' ');
            // ended 
            var lastList = [];
            let i = 0, j = 0;
            let correctWordCnt = 0;
            let inCorrectWordCnt = 0;
            let skipWordCnt = 0;
            let accuracy = 0;
            let wrongWords = 0;
            let marks = 0;

            //   end of new changess ---------------------------------


            document.querySelector(".result").style.display = "block";
            clearInterval(timer);
            document.getElementById("stop-test").style.display = "none";
            userInput.disabled = true;
            //  userInput = userInput.trim();
            let timeTaken = 1;
            if (time != 0) {
                timeTaken = (totalTimeInSecond - time) / 100;
            }
            let SPR_StudentPhone = localStorage.getItem("SPR_StudentPhone");
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Cookie", "BrowserId=g1Zrr_uOEe2gTR9C7VyOiA; CookieConsentPolicy=0:1; LSKey-c$CookieConsentPolicy=0:1");

            var raw = JSON.stringify({
                "Phone": SPR_StudentPhone,
                "courseDataId": courseDataId,
                "accuracy": accuracy.toFixed(2),
                "wrongWords": wrongWords,
                "stenoMarks": marks.toFixed(2) + "",
                "totalWords": quoteSection.length + '',
                "totalType": totaltypewords,
                "timeTaken": totalTimeInSecond - time,
                "totalTime": totalTimeInSecond,
                "backspaceCount": backspaceCount,
                "studentTypedData": totalTypedString,
                "submitTypedData": 'submitTypedData'
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            fetch("https://cloudcertitude15-dev-ed.develop.my.salesforce-sites.com/services/apexrest/BrightEducationSteno", requestOptions)
                .then(response => response.json())
                .then(result => {
                    let URL = 'StudentResult.html?Id=' + result;
                    window.open(URL, "_self");

                })
                .catch(error => console.log('error=', error));

        };

        //Start Test
        const startTest = () => {

            //window.location.href = "";

            mistakes = 0;
            timer = "";

            userInput.disabled = false;
            timeReduce();
            document.getElementById("stop-test").style.cursor = "not-allowed";
            document.getElementById("start-test").style.display = "none";
            document.getElementById("stop-test").style.display = "block";
            document.getElementById("stop-test").disabled = true;

        };

        window.onload = () => {
            userInput.value = "";
            document.getElementById("start-test").style.display = "block";
            document.getElementById("stop-test").style.display = "none";

            userInput.disabled = true;
            // renderNewQuote();
        };   
    </Script>

    <!-- include common vendor scripts used in demo pages -->
    <script src="js/jsone.js"></script>
    <script src="js/jstwo.js"></script>
    <script src="js/jsthree.js"></script>
    <script>
        document.addEventListener("contextmenu", (event) => {
            event.preventDefault();
        });
    </script>


    <!-- include ace.js -->
    <script src="dist/js/ace.min.js"></script>
    <!-- <script defer src="assets/js/main.js"></script>
    <script defer src="assets/js/MyComponents.js"></script> -->
</body>

</html>