<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Typing | BrightEducationSteno</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="assets/img/BrightEducationSteno.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet" />

    <!-- Vendor CSS Files -->
    <link href="assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <!--  Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <link href="assets/css/slider.css" rel="stylesheet" />
    <style>
        @font-face {
            font-family: Hindi;
            src: url(font/Hindi.ttf);
        }

        @font-face {
            font-family: 'Hindi';
            src: url('font/Hindi.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        .hindiFont {
            font-family: 'Hindi';
        }
    </style>

</head>

<body>
    <!-- Designed and Developed by Sunil Barara -->
    <!--Mobile Number: 7878438668 -->
    <app-contactcareernavbar></app-contactcareernavbar>


    <div class="section-title" style="padding-left: 4rem; padding-top: 10rem">
        <h2>Typing Test</h2>
        <p>Show your Typing skill</p>
    </div>
    <div class="body-container">
        <div class="main-container bgc-white">
            <div role="main" class="main-content">
                <div class="page-content">
                    <style>
                        .success {
                            color: #44b267;
                        }

                        .fail {
                            color: #e81c4e;
                        }


                        

                        h3.tittle,
                        h2.ptbl-inner-h-title,
                        h3.ptbl-inner-h-title {
                            color: #e83f3f;
                            font-size: 2.5em;
                            margin: 0;
                            text-align: center;
                            font-weight: 600;
                            letter-spacing: 3px;
                        }

                        h2.ptbl-inner-h-title,
                        h3.ptbl-inner-h-title {
                            margin-bottom: 1em;
                            text-transform: uppercase;
                        }

                        h3.tittle.two {
                            color: #fff;
                        } 
                        .skipped {
                            color: blue;
                        }

                        .switch {
                            position: relative;
                            display: inline-block;
                            width: 60px;
                            height: 34px;
                        }

                        .switch input {
                            opacity: 0;
                            width: 0;
                            height: 0;
                        }

                        .slider {
                            position: absolute;
                            cursor: pointer;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background-color: #ccc;
                            -webkit-transition: .4s;
                            transition: .4s;
                        }

                        .slider:before {
                            position: absolute;
                            content: "";
                            height: 26px;
                            width: 26px;
                            left: 4px;
                            bottom: 4px;
                            background-color: white;
                            -webkit-transition: .4s;
                            transition: .4s;
                        }

                        input:checked+.slider {
                            background-color: #2196F3;
                        }

                        input:focus+.slider {
                            box-shadow: 0 0 1px #2196F3;
                        }

                        input:checked+.slider:before {
                            -webkit-transform: translateX(26px);
                            -ms-transform: translateX(26px);
                            transform: translateX(26px);
                        }

                        /* Rounded sliders */
                        .slider.round {
                            border-radius: 34px;
                        }

                        .slider.round:before {
                            border-radius: 50%;
                        }
                    </style>
                    <!-- Our price plan section -->
                    <div class="plans-section" style="padding:21px;overflow-x: scroll!important;">

                        <!-- -------------------------- TYping Modal Code is Here   -------------------- -->
                        <!-- Main Body Starts -->
                        <div id="" class="container" style=" max-width: 100rem;">
                            <div class="stats" style="
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            font-size: 18px;
                            margin-bottom: 30px;
                            width: 100%;
                        ">
                                <!-- Left: Go Back -->
                                <div>
                                    <button style="
                                    background-color: #ff4a17;
                                    color: white;
                                    border: none;
                                    height: 31px;
                                    border-radius: 5px;
                                    padding: 0 12px;
                                " onclick="handleGoBack()">Go Back</button>
                                </div>

                                <!-- Middle: Select Time -->
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <label for="duration">Select Time:</label>
                                    <select name="duration" id="duration" onchange="handleTimeChange()"
                                        class="form-control-sm">
                                        <option value="1">1 Min</option>
                                        <option value="2">2 Mins</option>
                                        <option value="3">3 Mins</option>
                                        <option value="4">4 Mins</option>
                                        <option value="5">5 Mins</option>
                                        <option value="10">10 Mins</option>
                                        <option value="15">15 Mins</option>
                                    </select>
                                </div>

                                <!-- Right: Toggle + Timer -->
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    Backspace: <label class="switch">
                                        <input type="checkbox" onchange="handleBackspaceToggle(this)">
                                        <span class="slider round"></span>
                                    </label>
                                    <span style="
                                    font-size: 24px;
                                    font-weight: 500;
                                    font-family: Poppins, sans-serif;
                                    color: #263d4d;
                                ">
                                        Time: <span id="timer">1:00</span>
                                    </span>
                                </div>
                            </div>

                            <div id="quote" style="    text-align: justify;
    margin: 0px 0 30px 0;
    border: solid rgb(25 45 102) 2px;
    padding: 1rem;
    border-radius: 16px;
    overflow: auto;
    height: 20rem;
    font-weight: 700;
    font-size: 23px;" onmousedown="return false" onselectstart="return false"></div>
                            <textarea style="resize: none;
width: 100%;
border-radius: 5px;
padding: 10px 5px;
font-size: 16px;

    font-weight: 700;
    font-size: 23px;" rows="3" id="quote-input" placeholder="Type here when the test starts..." class="hindiFont"
                                spellcheck="false"></textarea>
                            <button class="button" style="float: right;
  margin-top: 20px;
  background-color: rgb(25 45 102);
  color: #ffffff;
  border: none;
  padding: 10px 30px;
  border-radius: 5px;
  font-size: 18px;" id="start-test" onclick="startTest()">Start Test</button>
                            <button class="button" style="float: right;
  margin-top: 20px;
 background-color: rgb(25 45 102);
  color: #ffffff;
  border: none;
  padding: 10px 30px;
  border-radius: 5px;
  font-size: 18px;" id="stop-test" onclick="displayResult()">Stop Test</button>

                        </div>
                    </div>
                </div>
            </div>
        </div><!-- .modal-aside -->
    </div>
    </div>
    <app-whatsapp></app-whatsapp>
    <app-footer></app-footer>
    <div id="preloader"></div>
    <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>


    <!-- Vendor JS Files -->
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <script src="https://code.jquery.com/jquery-2.2.0.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.js"></script>

    <!--   Main JS File -->
    <script defer src="assets/js/main.js"></script>
    <script src="assets/js/MyComponents.js"></script>
    <script>
        const textarea = document.getElementById("quote-input");

        // Always keep cursor at end
        function moveCursorToEnd() {
            const len = textarea.value.length;
            textarea.setSelectionRange(len, len);
        }
       
        let allowBackspace = false;
        textarea.addEventListener("keydown", (e) => {
          
            if (allowBackspace && e.key === "Backspace") {
                e.preventDefault();
                return;
            }
        });
        textarea.addEventListener("select", moveCursorToEnd);
        handleBackspaceToggle = (checkbox) => {
            allowBackspace = checkbox.checked;
            console.log('allowBackspace=>', allowBackspace)
        }
        let backspaceCount = 0;
        $(document).ready(function () {
            checkIsSprStudent();
            document.getElementById('header').style.backgroundColor = '#38434b'
        })

        var dropdown = document.getElementById("duration");

        // Add an event listener to the dropdown to listen for changes
        dropdown.addEventListener("change", function () {
            // Get the selected value
            var selectedValue = dropdown.value;

            // Print or do something with the selected value
            console.log("Selected value: " + selectedValue);
            document.getElementById("timer").innerText = selectedValue + ':00';
            time = parseInt(selectedValue) * 60;
            totalTimeInSecond = parseInt(selectedValue) * 60;
        });
        let time = 60;
        let totalTimeInSecond;
        $(document).ready(function () {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            let id = urlParams.get('Id')
            if (id == null) {
                id = queryString.substring(queryString.indexOf('D=') + 2, queryString.length)
            }
            renderNewQuote(id)
            let userInput = document.getElementById('quote-input')
            mistakes = 0;
            timer = "";
            userInput.disabled = true;
            // timeReduce();
            document.getElementById("stop-test").style.cursor = "not-allowed";
            document.getElementById("stop-test").disabled = true;
        })
        //Display random quotes
        const renderNewQuote = async (id) => {
            const quoteSection = document.getElementById("quote");
            console.log('rendernew')
            courseDataId = id;
            let SPR_StudentPhone = localStorage.getItem("SPR_StudentPhone");
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            myHeaders.append("Cookie", "BrowserId=g1Zrr_uOEe2gTR9C7VyOiA; CookieConsentPolicy=0:1; LSKey-c$CookieConsentPolicy=0:1");

            var raw = JSON.stringify({
                "Phone": SPR_StudentPhone,
                "courseContentId": id,
                "getTypingTestContent": 'getTypingTestContent'
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            fetch("https://cloudcertitude15-dev-ed.develop.my.salesforce-sites.com/services/apexrest/BrightEducationSteno", requestOptions)
                .then(response => response.json())
                .then(result => {

                    result = JSON.parse(result);
                    console.log('typing result=>', result)
                    if (result[0].Test_Language__c == 'Hindi') {

                        document.getElementById("quote").style.fontFamily = 'Hindi';
                        document.getElementById("quote-input").style.fontFamily = 'Hindi';
                        // document.getElementById("wrapperResultId").style.fontFamily = 'Hindi';
                        document.getElementById("quote-input").setAttribute("placeholder", " टेस्ट शुरू होने पर यहां टाइप करें");
                    } else {
                        document.getElementById("quote").style.fontFamily = 'monospace';
                        document.getElementById("quote-input").style.fontFamily = 'monospace';
                        // document.getElementById("wrapperResultId").style.fontFamily = 'monospace';
                    }

                    time = parseInt(result[0].Duration__c) * 60;
                    totalTimeInSecond = parseInt(result[0].Duration__c) * 60;
                    let content = result[0].Audio_Text__c;
                    content = content.replace('<p>', '');
                    content = content.replace('</p>', '');
                    quote = content;

                     let arr = quote.split("").map((value) => {
                        //wrap the characters in a span tag
                        return "<span class='quote-chars'>" + value + "</span>";
                    });
                    //join array for displaying
                    quoteSection.innerHTML += arr.join("");
                })
                .catch(error => console.log('error=', error));
        };

        // Add these variables at the top with other variable declarations
        let fullMistakes = 0;
        let halfMistakes = 0;
        let keyStrokes = 0;
        let startTime, endTime;
        let correctKeystrokes = 0;
        let incorrectKeystrokes = 0;
        let userInput = document.getElementById('quote-input')
        const quoteSection = document.getElementById("quote");
        // Update the input event listener to track more metrics
        userInput.addEventListener("input", (e) => {
            console.log('input event triggered', e.target.value);
            calculateTypingAccuracy();

            // Track backspaces
            if (e.inputType === "deleteContentBackward") {
                backspaceCount++;
            }

            // Track total keystrokes (excluding backspace)
            if (e.data && e.inputType !== "deleteContentBackward") {
                keyStrokes++;
            }
        });

        //Sets timer
        const timeReduce = () => {
            //time = 60;
            timer = setInterval(updateTimer, 1000);
        };

        //Start Test
        const startTest = () => {
            let userInput = document.getElementById('quote-input')
            mistakes = 0;
            timer = "";
            var dropdown = document.getElementById("duration");
            dropdown.setAttribute("disabled", true);
            userInput.disabled = false;
            timeReduce();
            document.getElementById("stop-test").style.cursor = "not-allowed";
            document.getElementById("start-test").style.display = "none";
            document.getElementById("stop-test").style.display = "block";
            document.getElementById("stop-test").disabled = true;

        };
        function updateTimer() {
            var timerElement = document.getElementById("timer");
            var currentTime = timerElement.innerText;
            var timeParts = currentTime.split(":");
            var minutes = parseInt(timeParts[0]);
            var seconds = parseInt(timeParts[1]);
            if (minutes == 0 && seconds == 0) {
                //End test if timer reaches 0
                displayResult();
            } else {
                var totalSeconds = minutes * 60 + seconds;
                if (totalSeconds > 0) {
                    totalSeconds--;
                    time--;
                    timerElement.innerText = convertSecondsToTime(totalSeconds) ;
                }
            }
        }
        function convertSecondsToTime(seconds) {
            var minutes = Math.floor(seconds / 60);
            var remainingSeconds = seconds % 60;

            // Add leading zero if necessary
            var minutesStr = minutes < 10 ? "0" + minutes : minutes.toString();
            var secondsStr = remainingSeconds < 10 ? "0" + remainingSeconds : remainingSeconds.toString();

            return minutesStr + ":" + secondsStr;
        }
        const displayResult = () => {
            let userInput = document.getElementById('quote-input')
            //document.getElementById("resultMainDiv").style.display = 'block';
            document.getElementById("quote-input").style.display = 'none';
            document.getElementById("quote").style.display = 'none';
            // document.getElementById("timeDivId").style.display = 'none';

            //   var resultSection = document.getElementById("wrapperResultId");
            var quotee = document.getElementById("quote").innerText;
            const words = quotee.split(/\s+/);
            let typedwords = document.getElementById("quote-input").value.replace(/\s+/g, ' ').trim().split(' ');

            let totalTypedString = typedwords.join(' ');
            // typedwords = typedwords.substring(1,typedwords.length-1)
            let i = 0, j = 0;
            let correctWordCnt = 0;
            let inCorrectWordCnt = 0;
            let skipWordCnt = 0;

            // document.querySelector(".result").style.display = "block";
            clearInterval(timer);
            document.getElementById("stop-test").style.display = "none";
            userInput.disabled = true;

            let timeTaken = 1;
            if (time != 0) {
                timeTaken = (totalTimeInSecond - time) / 60; // in minutes
            }

            // Calculate all metrics
            const grossWPM = (keyStrokes / 5) / timeTaken;
            const netWPM = grossWPM - (fullMistakes / timeTaken);
            const accuracyData = 100//calculateTypingAccuracy().split('@');
            const accuracy = 100//parseFloat(accuracyData[0]);
            fullMistakes = 0// parseInt(accuracyData[1]);
            halfMistakes = 0// parseInt(accuracyData[2]);

            // Net DPH (Depressions Per Hour)
            const netDPH = (keyStrokes - backspaceCount) * (60 / timeTaken);

            // Marks calculation (example: 50 - (fullMistakes * 2) - (halfMistakes * 1))
            const marksOutOf50 = Math.max(0, 50 - (fullMistakes * 2) - (halfMistakes * 1));
            const marksOutOf25 = Math.max(0, 25 - (fullMistakes * 1) - (halfMistakes * 0.5));

            // Send data to server
            let SPR_StudentPhone = localStorage.getItem("SPR_StudentPhone");
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");
            let totaltypewords = typedwords.length;
            var raw = JSON.stringify({
                "Phone": SPR_StudentPhone,
                "courseDataId": courseDataId,
                "accuracy": accuracy.toFixed(2),
                "grossSpeed": grossWPM.toFixed(2),
                "netSpeed": netWPM.toFixed(2),
                "netDPH": netDPH.toFixed(0),
                "marksOutOf50": marksOutOf50.toFixed(1),
                "marksOutOf25": marksOutOf25.toFixed(1),
                "backspaceCount": backspaceCount,
                "totalKeystrokes": keyStrokes,
                "totalWords": quoteSection.innerText.length + '',
                "totalType": totaltypewords,
                "timeTaken": totalTimeInSecond - time, // in seconds
                "totalTime": totalTimeInSecond,
                "contentData": quoteSection.innerText,
                "studentTypedData": totalTypedString ? totalTypedString : 'Blank',
                "submitTypedData": 'submitTypedData'
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch("https://cloudcertitude15-dev-ed.develop.my.salesforce-sites.com/services/apexrest/BrightEducationSteno", requestOptions)
                .then(response => response.json())
                .then(result => {
                    console.log(result)
                    let URL = 'StudentResult.html?Id=' + result;
                    window.open(URL, "_self");
                })
                .catch(error => console.log('error=', error));
        };
        // Modify the calculateTypingAccuracy function
        function calculateTypingAccuracy() {
            let userInputText = document.getElementById('quote-input').value;
            if (userInputText.length > 0) {
                document.getElementById("stop-test").disabled = false;
                document.getElementById("stop-test").style.cursor = "pointer";
            } else {
                document.getElementById("stop-test").style.cursor = "not-allowed";
                document.getElementById("stop-test").disabled = true;
            }
        }
        function handleGoBack() {
            history.back();
            var part1 = document.getElementById('datatable');
            var part2 = document.getElementById('typingModalId');
            part1.style.display = 'table';
            part2.style.display = 'none';
            quote = '';
        }
    </script>

    <!-- include common vendor scripts used in demo pages -->
    <script src="js/jsone.js"></script>
    <script src="js/jstwo.js"></script>
    <script src="js/jsthree.js"></script>
    <script>
        document.addEventListener("contextmenu", (event) => {
            event.preventDefault();
        });
    </script>


</body>

</html>